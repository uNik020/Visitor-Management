<div class="form-container">
  <h2>Add Visitor</h2>
  <form [formGroup]="visitorForm" (ngSubmit)="onSubmit()">
    <div class="form-grid">
      <label
        >Full Name
        <input type="text" formControlName="fullName" />
        <div
          class="error"
          *ngIf="visitorForm.get('fullName')?.touched && visitorForm.get('fullName')?.invalid"
        >
          Full Name is required.
        </div>
      </label>

      <label
        >Email
        <input type="email" formControlName="email" />
        <div
          class="error"
          *ngIf="visitorForm.get('email')?.touched && visitorForm.get('email')?.invalid"
        >
          Valid email is required.
        </div>
      </label>

      <label
        >Contact Number
        <input type="text" formControlName="phoneNumber" />
        <div
          class="error"
          *ngIf="visitorForm.get('phoneNumber')?.touched && visitorForm.get('phoneNumber')?.invalid"
        >
          Enter a valid 10-digit phone number.
        </div>
      </label>

      <label
        >Address (Optional)
        <textarea formControlName="address"></textarea>
      </label>

      <label
        >Visit Purpose
        <input type="text" formControlName="purpose" />
        <div
          class="error"
          *ngIf="visitorForm.get('purpose')?.touched && visitorForm.get('purpose')?.invalid"
        >
          Visit Purpose is required.
        </div>
      </label>

      <label>
        Upload Photo
        <input
          type="file"
          accept="image/*"
          (change)="onPhotoSelected($event)"
          capture="environment"
        />
        <div class="error" *ngIf="photoError">{{ photoError }}</div>
      </label>

      <label
        >Host Name
        <select formControlName="hostId">
          <option value="" disabled>Select Host</option>

          <option *ngFor="let host of hosts" [value]="host.hostId">
            {{ host.fullName }}
          </option>
        </select>
        <div
          class="error"
          *ngIf="visitorForm.get('hostName')?.touched && visitorForm.get('hostName')?.invalid"
        >
          Host Name is required.
        </div>
      </label>

      <label
        >Company Name
        <input type="text" formControlName="companyName" />
      </label>

      <label
        >Comment
        <textarea formControlName="comment"></textarea>
      </label>

      <label
        >ID Proof Type
        <input
          type="text"
          formControlName="idProofType"
          placeholder="e.g., Aadhar, PAN"
        />
      </label>

      <label
        >ID Proof Number
        <input type="text" formControlName="idProofNumber" />
      </label>

      <label
        >License Plate Number
        <input type="text" formControlName="licensePlateNumber" />
      </label>

      <!-- âœ… Pass Code + QR Code: Nicely styled section -->
      <div class="qr-section">
        <div class="passcode-display">
          <label>Pass Code:</label>
          <span class="code">{{ passCode }}</span>
        </div>

        <div class="qrcode-box" *ngIf="passCode">
          <label>QR Code</label>
          <qrcode
            [qrdata]="passCode"
            [width]="160"
            [errorCorrectionLevel]="'M'"
          >
          </qrcode>
        </div>
      </div>

      <!-- âœ… Pre-Registered: Checkbox before label, inline -->
      <div class="checkbox-row">
        <input
          type="checkbox"
          formControlName="isPreRegistered"
          id="isPreRegistered"
        />
        <label for="isPreRegistered">Pre-Registered?</label>
      </div>

      <!-- âœ… Expected Visit Date: Only shows if checked -->
      <div
        *ngIf="visitorForm.get('isPreRegistered')?.value"
        class="expected-date"
      >
        <label>
          Expected Visit Date & Time
          <input
            type="datetime-local"
            formControlName="expectedVisitDateTime"
          />
        </label>
        <div
          class="error"
          *ngIf="visitorForm.get('expectedVisitDateTime')?.touched && visitorForm.get('expectedVisitDateTime')?.invalid"
        >
          Expected date is required when pre-registering.
        </div>
      </div>

      <!-- Dropdown for Companion Count -->
      <label>
        Number of Companions
        <select
          #companionSelect
          (change)="onCompanionCountChange(companionSelect.value)"
        >
          <option *ngFor="let n of [0, 1, 2, 3, 4]" [value]="n">{{ n }}</option>
        </select>
      </label>

      <!-- ðŸ§â€â™‚ï¸ Companion Forms -->
      <div
        formArrayName="companions"
        class="companions-section"
        *ngIf="companionForms.length > 0"
      >
        <div
          *ngFor="let companion of companionForms.controls; let i = index"
          [formGroupName]="i"
          class="companion-card"
        >
          <h3>Companion {{ i + 1 }}</h3>

          <label>
            Full Name
            <input type="text" formControlName="fullName" />
            <div
              class="error"
              *ngIf="companion.get('fullName')?.touched && companion.get('fullName')?.invalid"
            >
              Companion full name is required.
            </div>
          </label>

          <label>
            Contact Number
            <input type="text" formControlName="contactNumber" />
          </label>

          <label>
            Email
            <input type="email" formControlName="email" />
          </label>
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="visitorForm.invalid">Add Visitor</button>
  </form>
</div>
