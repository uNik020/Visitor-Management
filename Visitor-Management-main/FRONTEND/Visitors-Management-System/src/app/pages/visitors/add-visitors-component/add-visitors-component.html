<div class="form-container">
  <h2>Add Visitor</h2>
  <form [formGroup]="visitorForm" (ngSubmit)="onSubmit()">
    <div class="form-grid">
      <label
        ><div class="inline">Full Name<i style="color: red">*</i></div>
        <input type="text" formControlName="fullName" />
        <div
          class="error"
          *ngIf="visitorForm.get('fullName')?.touched && visitorForm.get('fullName')?.invalid"
        >
          Full Name is required.
        </div>
      </label>

      <label
        ><div class="inline">Email<i style="color: red">*</i></div>
        <input type="email" formControlName="email" />
        <div
          class="error"
          *ngIf="visitorForm.get('email')?.touched && visitorForm.get('email')?.invalid"
        >
          Valid email is required.
        </div>
      </label>

      <label
        ><div class="inline">Phone Number<i style="color: red">*</i></div>
        <input type="text" formControlName="phoneNumber" />
        <div
          class="error"
          *ngIf="visitorForm.get('phoneNumber')?.touched && visitorForm.get('phoneNumber')?.invalid"
        >
          Enter a valid 10-digit phone number.
        </div>
      </label>

      <label
        ><div class="inline">Address<i>(Optional)</i></div>
        <textarea formControlName="address"></textarea>
      </label>

      <label
        ><div class="inline">Visit Purpose<i style="color: red">*</i></div>
        <input type="text" formControlName="purpose" />
        <div
          class="error"
          *ngIf="visitorForm.get('purpose')?.touched && visitorForm.get('purpose')?.invalid"
        >
          Visit Purpose is required.
        </div>
      </label>

      <label>
  <div class="inline">Visitor Photo <i style="color:red">*</i></div>

  <div *ngIf="!webcamImage" class="webcam-section">
    <webcam
      *ngIf="showWebcam"
      [trigger]="triggerObservable"
      (imageCapture)="handleImage($event)"
      (initError)="handleInitError($event)">
    </webcam>
    <div class="camera-buttons">
      <button type="button" (click)="captureImage()">üì∏ Capture Photo</button>
    </div>
  </div>

  <div *ngIf="webcamImage" class="preview-section">
    <label>Preview Captured Image:</label>
    <img [src]="webcamImage.imageAsDataUrl" width="200" />
    <div class="preview-buttons">
      <button type="button" (click)="clearImage()">üîÅ Retake</button>
    </div>
  </div>
</label>




      <label
        ><div class="inline">Host Name<i style="color: red">*</i></div>
        <select formControlName="hostId">
          <option value="" disabled>Select Host</option>

          <option *ngFor="let host of hosts" [value]="host.hostId">
            {{ host.fullName }}
          </option>
        </select>
        <div
          class="error"
          *ngIf="visitorForm.get('hostName')?.touched && visitorForm.get('hostName')?.invalid"
        >
          Host Name is required.
        </div>
      </label>

      <label
        >Company Name
        <input type="text" formControlName="companyName" />
      </label>

      <label
        >ID Proof Type
        <select formControlName="idProofType" name="idProofType">
          <option value="" disabled selected>Select ID Proof Type</option>
          <option value="Aadhar Card">Aadhar Card</option>
          <option value="Pan Card">Pan Card</option>
          <option value="Driving License">Driving License</option>
        </select>
      </label>
      <div
        *ngIf="visitorForm.get('idProofType')?.touched && visitorForm.get('idProofType')?.invalid"
        class="error"
      >
        ID Proof Type is required.
      </div>


      <label>ID Proof Number
        <input type="text" formControlName="idProofNumber" />
        <div class="error"
        *ngIf="idProofNumber?.touched && idProofNumber?.errors?.['required']"
        >
        ID Proof Number is required.
      </div>
      <div class="error" *ngIf="idProofNumber?.touched && idProofNumber?.errors?.['pattern']">
        <ng-container [ngSwitch]="idProofType?.value">
          <span *ngSwitchCase="'Aadhar Card'"
          >Enter a valid 12-digit Aadhar number.</span
          >
          <span *ngSwitchCase="'Pan Card'"
          >Enter a valid PAN (e.g., ABCDE1234F).</span
          >
          <span *ngSwitchCase="'Driving License'"
          >Enter a valid DL (e.g., MH0120190001234).</span
          >
          <span *ngSwitchDefault>Invalid format.</span>
        </ng-container>
      </div>
    </label>

      <label
        >Comment
        <textarea formControlName="comment"></textarea>
      </label>

      <label
        >License Plate Number
        <input type="text" formControlName="licensePlateNumber" />
      </label>

      <!-- Pass Code + QR Code: Nicely styled section -->
      <div class="qr-section">
        <div class="passcode-display">
          <label>Pass Code:</label>
          <span class="code">{{ passCode }}</span>
        </div>

        <div class="qrcode-box" *ngIf="passCode">
          <label>QR Code</label>
          <qrcode
            [qrdata]="passCode"
            [width]="160"
            [errorCorrectionLevel]="'M'"
          >
          </qrcode>
        </div>
      </div>

      <!-- ‚úÖ Pre-Registered: Checkbox before label, inline -->
      <div class="checkbox-row">
        <input
          type="checkbox"
          formControlName="isPreRegistered"
          id="isPreRegistered"
        />
        <label for="isPreRegistered">Pre-Registered?</label>
      </div>

      <!-- ‚úÖ Expected Visit Date: Only shows if checked -->
      <div
        *ngIf="visitorForm.get('isPreRegistered')?.value"
        class="expected-date"
      >
        <label>
          Expected Visit Date & Time
          <input
            type="datetime-local"
            formControlName="expectedVisitDateTime"
          />
        </label>
        <div
          class="error"
          *ngIf="visitorForm.get('expectedVisitDateTime')?.touched && visitorForm.get('expectedVisitDateTime')?.invalid"
        >
          Expected date is required when pre-registering.
        </div>
      </div>

      <!-- Dropdown for Companion Count -->
      <label>
        Number of Companions
        <select
          #companionSelect
          (change)="onCompanionCountChange(companionSelect.value)"
        >
          <option *ngFor="let n of [0, 1, 2, 3, 4]" [value]="n">{{ n }}</option>
        </select>
      </label>

      <!-- üßç‚Äç‚ôÇÔ∏è Companion Forms -->
      <div
        formArrayName="companions"
        class="companions-section"
        *ngIf="companionForms.length > 0"
      >
        <div
          *ngFor="let companion of companionForms.controls; let i = index"
          [formGroupName]="i"
          class="companion-card"
        >
          <h3>Companion {{ i + 1 }}</h3>

          <label>
            Full Name
            <input type="text" formControlName="fullName" />
            <div
              class="error"
              *ngIf="companion.get('fullName')?.touched && companion.get('fullName')?.invalid"
            >
              Companion full name is required.
            </div>
          </label>

          <label>
            Contact Number
            <input type="text" formControlName="contactNumber" />
          </label>

          <label>
            Email
            <input type="email" formControlName="email" />
          </label>
        </div>
      </div>
    </div>

    <button type="submit" [disabled]="visitorForm.invalid">Add Visitor</button>
  </form>
</div>
